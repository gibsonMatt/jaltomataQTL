---
title: "QTL Scanning for Manuscript"
author: "Matt Gibson"
output:
  html_document: default
  html_notebook: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(qtl)
library(ggplot2)
pcDir <- "c:/Users/matth/Documents/bin/jaltomataQTL/manuscript"
setwd(pcDir)
```

## Load the cross
```{r}
mapJal5.1 <- read.cross("csv",pcDir, "final_map_6_15_t.csv", genotypes=c("A", "H"), alleles=c("A", "B"), na.strings=c("-", "NA"), estimate.map=F,crosstype = "bc")
#write.cross(mapJal5.1, format="csvr")
#plot.map(mapJal5.1)
mapJal5.1 <- calc.genoprob(mapJal5.1, step=0.1)

names(mapJal5.1$geno) <- c('L.1', 'L.2', 'L.3', 'L.4', 'L.5', 'L.6', 'L.7', 'L.8', 'L.9', 'L.10', 'L.11', 'L.12')

mapJal5.1$geno <- mapJal5.1$geno[c(9, 6, 3, 5, 1, 2,4,7,8,10,11,12)]


#names(mapJal5.1$geno) <- c('L.9 (Ch.1)', 'L.6 (Ch.2)', 'L.3 (Ch.5)', 'L.5 (Ch.6)', 'L.1 (Ch.12)', 'L.2', 'L.4', 'L.7', 'L.8', 'L.10', 'L.11', 'L.12')
names(mapJal5.1$geno) <- c('(Ch.1)', '(Ch.2)', '(Ch.5)', '(Ch.6)', '(Ch.12)', 'L.2', 'L.4', 'L.7', 'L.8', 'L.10', 'L.11', 'L.12')


plot.map(mapJal5.1)
```

## Setup covariates
```{r}
bench <- pull.pheno(mapJal5.1, pheno.col = 3)
hmorph <- pull.pheno(mapJal5.1, pheno.col=c(3, 4))
fmorph <- pull.pheno(mapJal5.1, pheno.col=c(3, 5))
hcolor <- pull.pheno(mapJal5.1, pheno.col=c(3, 6))
fcolor <- pull.pheno(mapJal5.1, pheno.col=c(3, 7))
crossed <- pull.pheno(mapJal5.1, pheno.col=c(3, 8))
trichome <- pull.pheno(mapJal5.1, pheno.col=c(3,8))
veg <- pull.pheno(mapJal5.1, pheno.col=c(3, 10))
```

### Female morph (18:28)
```{r}
femMorph <- scanone(mapJal5.1, pheno.col=c(22,23,26), method="em", addcovar=fmorph)
for (x in 1:3){
  plot(femMorph, lodcolumn = x)
  abline(3,0,lty=2)
}
```

### Herm morph (29:41)
```{r}
hermMorph <- scanone(mapJal5.1, pheno.col=c(29, 30, 31, 32, 33, 34, 35, 36, 37, 39, 40, 41), method="em", addcovar=hmorph)
for (x in 1:12){
  plot(hermMorph, lodcolumn = x)
  abline(3,0,lty=2)
}
```


### Herm color (59:75)
```{r}
hermColor <- scanone(mapJal5.1, pheno.col=c(59,60,61,63,64,65,66,67,68,70,71,73,74,75), method="em", addcovar=hcolor)
for (x in 1:14){
  plot(hermColor, lodcolumn = x)
  abline(3,0,lty=2)
}
```

### Fertility and fruit traits (76:87)
```{r}
fertility <- scanone(mapJal5.1, pheno.col=c(77,78,79,80,81,82), method="em", addcovar=crossed)
for (x in 1:6){
  plot(fertility, lodcolumn = x)
  abline(3,0,lty=2)
}
```

### PCA Morph
```{r}
PCAFemMorph <- scanone(mapJal5.1, pheno.col=c(90,91,92), method="em", addcovar=fmorph)
for (x in 1:3){
  plot(PCAFemMorph, lodcolumn = x)
  abline(3,0,lty=2)
}

PCAHermMorph <- scanone(mapJal5.1, pheno.col=c(93,94,95), method="em", addcovar=hmorph)
for (x in 1:3){
  plot(PCAHermMorph, lodcolumn = x)
  abline(3,0,lty=2)
}
```

## Traits and columns
- fem corolla fusion : 22*
- fem corolla fusion proportion : 23*
- fem anther size : 26*
- fem nectar volume : 42
- inflor. size : 29*
- herm calyx diameter : 30*
- herm sepal length : 31*
- herm corolla diameter : 32*
- herm corolla depth : 33*
- herm corolla fusion : 34*
- herm corolla fusion proportion : 35*
- herm petal length : 36*
- herm stamen length : 37*
- herm ovary diameter : 39*
- herm style : 40*
- herm herkogamy : 41*
- herm nectar volume : 59*
- herm nectar color intensity : 60*
- herm nectar color RGB : 61*
- herm nectar color Green : 63*
- herm nectar color Blue : 64*
- herm nectar color Lightness : 65*
- herm nectar color a : 66*
- herm nectar color b : 67*
- herm petal color intensity : 68*
- herm petal color Red : 70*
- herm petal color Green : 71*
- herm petal color Lightness : 73*
- herm petal color a : 74*
- herm petal color b : 75*
- fruit mass : 77*
- fruit diameter : 78*
- seed count : 79*
- viable seed count : 80*
- viable seed T50 : 81*
- viable seed MGT : 82*

